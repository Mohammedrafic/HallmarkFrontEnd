<ejs-dialog
  id="dialog"
  #candidateDialog
  cssClass="dialog timesheet-details-dialog"
  [width]="'1180px'"
  [visible]="false"
  [animationSettings]="{ effect: 'SlideRight' }"
>
  <ng-template #content>
    <section class="container" *ngIf="timesheetDetails$ | async as timesheetDetails">
      <div class="profile-details-header">
        <img
          class="e-avatar e-avatar-xlarge"
          [src]="timesheetDetails.candidateId | candidateAvatar"/>

        <div class="flex flex-column">
          <h3 class="username">
            {{ timesheetDetails.candidateSurname }}, {{ timesheetDetails.candidateName}}
          </h3>

          <ejs-chiplist #chipList class="events-off">
            <e-chips>
              <e-chip
                [text]="timesheetDetails.statusText"
                [cssClass]="timesheetDetails.statusText || '' | chipsCssClass">
              </e-chip>
            </e-chips>
          </ejs-chiplist>
        </div>
        <div class="spacer"></div>

        <div class="header-controls">
          <div
          style="display: flex; align-items: center"
          class="timesheet-details-upload-container"
          #uploadContainer>

<!--            TODO: Remove after resolving issue with date filter. -->
            <div class="date-filter-mock" style="width: 300px"></div>

            <button
             ejs-button
             cssClass="e-outline"
             class="upload-button"
             #uploadBtn
             (click)="uploadTooltip.open(uploadContainer)"
             >Upload
              <i-feather name="upload" class="icon"></i-feather>
            </button>

            <ejs-tooltip #uploadTooltip
                         [container]="uploadContainer"
                         [showTipPointer]="false"
                         opensOn="Custom"
                         position="TopLeft" width="100%">
              <ng-template #content>
                <div class="file-upload-area-container"
                     appClickOutside
                     (clickOutside)="uploadTooltip.close()"
                     [exclude]="uploadBtn.element"
                >
                  <h2>Upload Documents</h2>
                  <div class="upload-area" #uploadArea>
                    <div class="droparea" #dropEl (click)="browse()">
                      <span>Drag & Drop or <span class="browse-link">browse</span> files here</span>
                    </div>
                    <ejs-uploader #uploader
                                  [dropArea]="dropEl"
                                  [allowedExtensions]="allowedFileExtensions"
                                  [maxFileSize]="maxFileSize"
                                  [multiple]="true"
                                  [autoUpload]="false"
                                  [showFileList]="false"
                                  (selected)="onFilesSelected($event)">
                    </ejs-uploader>
                  </div>
                </div>
              </ng-template>
            </ejs-tooltip>

            <app-export-button
                    (csvExport)="exportProfileDetails(exportedFileType.csv)"
                    (excelExport)="exportProfileDetails(exportedFileType.excel)"
                    (customExport)="showCustomExportDialog()"
            ></app-export-button>
         </div>

         <i-feather name="x" class="icon close-button" (click)="handleProfileClose()"></i-feather>
       </div>
      </div>

      <div class="order-header">
        <h2 class="order-id">Order ID {{ timesheetDetails?.orderId}}</h2>
        <div class="bootstrap reject-reason-input" *ngIf="timesheetDetails?.rejectReason as rejectReason">
          <div class="e-input input">{{rejectReason}}</div>
        </div>

        <div class="controls-block">
          <div class="checkbox-block" *ngIf="isAgency">
            <ejs-switch #dnwSwitch
              class="toggle"
              [checked]="timesheetDetails.isDidNotWork"
              (change)="onDWNCheckboxSelectedChange($event, dnwSwitch)"
            ></ejs-switch>
            <span>DNW</span>
          </div>

          <button
            *ngIf="!isAgency"
            ejs-button cssClass="e-outline"
            class="reject-button"
            (click)="onRejectButtonClick()">Reject
          </button>

          <button ejs-button cssClass="e-primary" (click)="handleApprove()">
            {{submitText}}
          </button>
        </div>
      </div>

      <div class="job-general-info tile-dark-blue">
          <app-profile-details-job-info
                  [jobData]="timesheetDetails"
          ></app-profile-details-job-info>
      </div>

      <div class="profile-hours-statistics">
          <div class="tile-dark-blue" *ngIf="chartsVisible$ | async">
              <app-profile-cumulative-hours
                      [statisticsData]="timesheetDetails.timesheetStatistic.timesheetStatisticDetails"
              ></app-profile-cumulative-hours>
          </div>

          <div class="tile-dark-blue miles" *ngIf="milesData$ | async as milesData">
            <app-profile-miles [milesData]="milesData"></app-profile-miles>
          </div>

          <div class="tile-dark-blue profile-uploads" *ngIf="timesheetDetails?.attachments?.length">
            <app-attachments-uploads [attachments]="timesheetDetails.attachments"></app-attachments-uploads>
          </div>

         <div class="tile-dark-blue profile-invoices" *ngIf="timesheetDetails?.invoices?.length">
           <app-profile-invoices [invoices]="timesheetDetails.invoices"></app-profile-invoices>
         </div>
      </div>

      <section class="profile-table-container">
        <app-profile-timesheet-table
          *ngIf="tmesheetRecords$ | async as timesheetRecords"
          [candidateId]="candidateId"
          (openAddSideDialog)="openAddDialog()"
          (changesSaved)="handleEditChanges($event)"
        >
        </app-profile-timesheet-table>
      </section>

    </section>
    <app-navigation-panel
            prevLabel="Previous Timesheet"
            nextLabel="Next Timesheet"
            [prevDisabled]="currentSelectedRowIndex === 0"
            [nextDisabled]="isNextDisabled"
            (prevClick)="onNextPreviousOrder(false)"
            (nextClick)="onNextPreviousOrder(true)"
    ></app-navigation-panel>
  </ng-template>
</ejs-dialog>

<app-timesheet-reject-reason-dialog
  [(visible)]="rejectReasonDialogVisible"
  [container]="candidateDialog.element"
  (rejectReasonChange)="handleReject($event)"
></app-timesheet-reject-reason-dialog>

<app-add-timesheet
  (updateTable)="handleUpdateTable()">
</app-add-timesheet>

<app-export-dialog
        [columns]="columnsToExport"
        [fileName]="fileName"
        (cancel)="closeExport()"
        (export)="customExport($event)"
></app-export-dialog>
