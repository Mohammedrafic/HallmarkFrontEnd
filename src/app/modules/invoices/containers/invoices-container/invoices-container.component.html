<app-page-toolbar>
  <ng-container left>
    <app-invoices-table-tabs
      [tabConfig]="tabsConfig"
      (changeTab)="handleChangeTab($event)">
    </app-invoices-table-tabs>
  </ng-container>

  <ng-container right>
    <app-search class="search" *ngIf="false"></app-search>
    <button
      ejs-button
      cssClass="e-outline button-filter button--no-wrap"
      (click)="showFilters()">
      <div class="filter-button-content">
        <span *ngIf="appliedFiltersAmount" class="e-badge e-badge-success e-badge-circle">{{ appliedFiltersAmount }}</span>
        Filters <i-feather name="sliders" class="icon"></i-feather>
      </div>
    </button>
    <app-export-button (optionSelected)="onExportOptionSelect($event)"></app-export-button>
    <button ejs-button class="e-primary"
      (click)="openAddDialog()">
      Add Manual Invoice
    </button>
    <button ejs-button class="e-primary"
            (click)="createInvoiceDialog.show()">
      Create Invoice
    </button>
  </ng-container>
</app-page-toolbar>

<section class="invoices-table-container">
  <ng-container [ngSwitch]="selectedTabIdx">
    <ng-container *ngSwitchCase="0">
      <app-invoice-records-table [tableData]="invoiceRecordsData$ | async"
                                 #invoiceRecordsTable
      ></app-invoice-records-table>
    </ng-container>
    <ng-container *ngSwitchDefault>
      <app-all-invoices-table
        #allInvoicesTable
        [tableData]="allInvoices"
        (rowSelectedData)="handleRowSelected($event)">
      </app-all-invoices-table>
    </ng-container>
  </ng-container>
</section>

<app-invoice-record-dialog #invoiceRecordDialog></app-invoice-record-dialog>

<ejs-dialog
        #createInvoiceDialog
        cssClass="dialog filter"
        [width]="470"
        [visible]="false"
        [isModal]="true"
        [animationSettings]="{ effect: 'SlideRight' }"
>
  <ng-template #content>
    <form class="create-invoice-dialog-content">
      <div class="title">
        <h2>Create Invoice</h2>

        <div class="spacer"></div>

        <button ejs-button class="e-outline" (click)="createInvoiceDialog.hide()" type="button">Cancel</button>
        <button ejs-button class="e-primary"
                type="submit"
                (click)="$event.preventDefault();"
        >
          Create
        </button>
      </div>

      <div class="dropdown-container bootstrap">
        <label>Group Invoice by</label>
        <ejs-dropdownlist [dataSource]="invoicesGroupByOptions"
                          [value]="invoicesGroupByOptions[0].text"
                          [fields]="fieldValues" (select)="onInvoiceGrouping($event)" #groupBy></ejs-dropdownlist>
      </div>
    </form>
  </ng-template>
</ejs-dialog>

<app-invoice-detail-container
  [currentSelectedRowIndex]="currentSelectedTableRowIndex | async"
  [maxRowIndex]="allInvoices?.items?.length || 0"
  (nextPreviousOrderEvent)="onNextPreviousOrderEvent($event)"
  (updateTable)="handleUpdateTable()"
></app-invoice-detail-container>

<app-manual-invoice-dialog></app-manual-invoice-dialog>

<app-invoices-filters-dialog
  [activeTabIdx]="selectedTabIdx"
  (appliedFiltersAmount)="changeFiltersAmount($event)"
  (resetFilters)="resetFilters()"
  (updateTableByFilters)="updateTableByFilters($event)">
</app-invoices-filters-dialog>
