<section class="grid flex-column">
  <ejs-grid
    #grid
    [dataSource]="gridDataSource"
    (rowDataBound)="rowDataBound($event)"
    [allowPaging]="allowPaging"
    [pageSettings]="pageSettings"
    [height]="fullScreenGridHeight"
    [rowHeight]="rowHeight"
    [resizeSettings]="resizeSettings"
    [allowSorting]="allowSorting"
    [allowResizing]="allowResizing"
    class="grid-component"
  >
    <ng-template #detailTemplate let-data>
      <table class="detailtable" width="100%">
        <colgroup>
          <col width="400">
          <col width="150">
          <col width="150">
          <col width="150">
          <col width="400">
          <col width="120">
        </colgroup>
        <tbody>
        <tr *ngFor="let child of data.children">
          <td class="e-rowcell e-templatecell"></td>
          <td class="e-rowcell e-templatecell">{{child.regionName}}</td>
          <td class="e-rowcell e-templatecell">{{child.locationName}}</td>
          <td class="e-rowcell e-templatecell">{{child.departmentName}}</td>
          <td class="e-rowcell e-templatecell">
            <span *ngIf="data.controlType === organizationSettingControlType.Checkbox">{{child.value === 'true' ? 'Yes' : 'No'}}</span>
            <span *ngIf="data.controlType === organizationSettingControlType.Multiselect || child.controlType === organizationSettingControlType.Select">
                <span *ngFor="let option of child.value; let i = index">{{option.text}}
                  <span *ngIf="i !== data.value.length - 1">, </span>
                </span>
              </span>
            <span *ngIf="data.controlType === organizationSettingControlType.Text">{{child.value}}</span>
            <span *ngIf="data.controlType === organizationSettingControlType.DateTime">{{child.value | date: 'MM/dd/yyyy'}}</span>
          </td>
          <td class="e-rowcell e-templatecell">
            <div class="row-tool-buttons">
              <button
                ejs-button
                cssClass="e-flat primary-icon-button"
                (click)="onEditButtonClick(data, child, $event)"
                [disabled]="!data.overridableByOrganization || !hasAccess"
              >
                <span class="edit-button" ><i-feather name="edit" class="icon"></i-feather></span>
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </ng-template>
    <e-columns>
      <e-column field="name" headerText="ATTRIBUTE" width=400></e-column>
      <e-column field="regionName" headerText="REGION" width=150></e-column>
      <e-column field="locationName" headerText="LOCATION" width=150></e-column>
      <e-column field="departmentName" headerText="DEPARTMENT" width=150></e-column>
      <e-column field="value" headerText="VALUE" width=400>
        <ng-template #template let-data>
          <span *ngIf="data.controlType === organizationSettingControlType.Checkbox">{{data.value === 'true' ? 'Yes' : 'No'}}</span>
          <span *ngIf="data.controlType === organizationSettingControlType.Multiselect || data.controlType === organizationSettingControlType.Select">
            <span *ngFor="let option of data.value; let i = index">{{option.text}}
              <span *ngIf="i !== data.value.length - 1">, </span>
            </span>
          </span>
          <span *ngIf="data.controlType === organizationSettingControlType.Text">{{data.value}}</span>
          <span *ngIf="data.controlType === organizationSettingControlType.DateTime">{{data.value | date: 'MM/dd/yyyy'}}</span>
        </ng-template>
      </e-column>
      <e-column textAlign="Right" width=120>
        <ng-template #template let-data>
          <div class="row-tool-buttons">
            <button
              ejs-button
              cssClass="e-flat default-icon-button"
              (click)="onOverrideButtonClick(data)"
              [disabled]="(!data.overridableByRegion && !data.overridableByLocation && !data.overridableByDepartment) || !hasAccess"
            >
              <span class="edit-button" ><i-feather name="plus" class="icon"></i-feather></span>
            </button>
            <button
              ejs-button
              cssClass="e-flat primary-icon-button"
              (click)="onEditButtonClick(data, undefined, $event)"
              [disabled]="!data.overridableByOrganization || !hasAccess"
            >
              <span class="edit-button" ><i-feather name="edit" class="icon"></i-feather></span>
            </button>
          </div>
        </ng-template>
      </e-column>
    </e-columns>
    <ng-template #pagerTemplate let-data>
      <div class="e-pagertemplate">
        <div class="control-section">
          <div class="content-wrapper">
            <section class="left-side-pager-controls">
              <ejs-dropdownlist
                id="rowsPerPage"
                class="dropdown-no-border"
                [dataSource]="rowsPerPageDropDown"
                [(value)]="activeRowsPerPageDropDown"
                (change)="onRowsDropDownChanged()"
              >
              </ejs-dropdownlist>
              <ejs-numerictextbox
                id="goToPage"
                class="numeric-input-no-border"
                format="#"
                [validateDecimalOnType]="validateDecimalOnType"
                [decimals]="decimals"
                placeholder="Go to:"
                min="1" [max]="lastAvailablePage"
                [showSpinButton]="false"
                (change)="onGoToClick($event)"
              >
              </ejs-numerictextbox>
            </section>
            <section class="right-side-pager-controls">
              <ejs-pager
                id="gridPager"
                #gridPager
                [pageSize]="pageSizePager"
                [totalRecordsCount]="totalDataRecords"

                [enablePagerMessage]="false"
                [currentPage]="currentPagerPage"
                (click)="onGoToClick($event)"
              >
              </ejs-pager>
            </section>
          </div>
        </div>
      </div>
    </ng-template>
  </ejs-grid>
</section>

<app-side-dialog
  (formCancelClicked)="onFormCancelClick()"
  (formSaveClicked)="onFormSaveClick()"
  [header]="dialogHeader + ' Settings'"
>
  <form class="form-container"
        id="addEditRecordForm"
        *ngIf="isFormShown"
        [formGroup]="organizationSettingsFormGroup">
    <div>
      <div class="input-container bootstrap">
        <label for="attribute">Attribute</label>
        <div class="input-group">
          <input
            id="attribute"
            class="e-input"
            type="text"
            formControlName="name"/>
        </div>
      </div>
    </div>

    <form [formGroup]="regionFormGroup" *ngIf="isEdit">
      <div class="input-container bootstrap">
        <label for="region">Region</label>
        <div class="input-group dropdown">
          <ejs-dropdownlist
            id="region"
            placeholder="Region"
            [dataSource]="regions$ | async"
            [fields]="regionLocationFields"
            (change)="onRegionChange($event)"
            [enabled]="!isParentEdit"
            formControlName="regionId">
          </ejs-dropdownlist>
        </div>
      </div>
    </form>

    <form [formGroup]="regionRequiredFormGroup" *ngIf="!isEdit">
      <div class="input-container bootstrap">
        <label for="regionRequired">Region <span class="required">*</span></label>
        <div class="input-group dropdown">
          <ejs-dropdownlist
            id="regionRequired"
            placeholder="Region"
            appValidateWithMessage
            [dataSource]="regions$ | async"
            [fields]="regionLocationFields"
            (change)="onRegionChange($event)"
            formControlName="regionId">
          </ejs-dropdownlist>
        </div>
      </div>
    </form>

    <form [formGroup]="locationFormGroup">
      <div class="input-container bootstrap">
        <label for="location">Location</label>
        <div class="input-group dropdown">
          <ejs-dropdownlist
            id="location"
            placeholder="Location"
            [dataSource]="locations$ | async"
            [fields]="regionLocationFields"
            (change)="onLocationChange($event)"
            [enabled]="!isParentEdit"
            formControlName="locationId">
          </ejs-dropdownlist>
        </div>
      </div>
    </form>

    <form [formGroup]="departmentFormGroup">
      <div class="input-container bootstrap">
        <label for="department">Department</label>
        <div class="input-group dropdown">
          <ejs-dropdownlist
            id="department"
            placeholder="Department"
            [dataSource]="departments$ | async"
            [fields]="departmentFields"
            (change)="onDepartmentChange($event)"
            [enabled]="!isParentEdit"
            formControlName="departmentId">
          </ejs-dropdownlist>
        </div>
      </div>
    </form>

    <div [ngSwitch]="formControlType">
      <div class="input-container" *ngSwitchCase="organizationSettingControlType.Checkbox">
        <div class="input-group switch">
          <ejs-switch
            id="switcher"
            class="switch"
            formControlName="value"
          ></ejs-switch>
          <label class="switch-label">Value</label>
        </div>
      </div>

      <div class="input-container datepicker bootstrap" *ngSwitchCase="organizationSettingControlType.DateTime">
        <label for="datepicker">Value <span class="required">*</span></label>
        <div class="input-group datepicker">
          <ejs-datepicker
            id="datepicker"
            class="datepicker"
            format="MM/dd/yyyy"
            placeholder="MM/DD/YYYY"
            appValidateWithMessage
            [showClearButton]="false"
            [enableMask]="true"
            [maskPlaceholder]="{ day: 'DD', month: 'MM', year: 'YYYY' }"
            formControlName="value"
          ></ejs-datepicker>
        </div>
      </div>

      <div *ngSwitchCase="organizationSettingControlType.Text">
        <div class="input-container bootstrap" *ngIf="textFieldType === textFieldTypeControl.Email">
          <label for="email">Value</label>
          <div class="input-group">
            <input
              id="email"
              class="e-input"
              type="email"
              placeholder="Value"
              formControlName="value"
            />
            <i-feather
              name="alert-circle"
              class="icon validation-icon"
              [ngStyle]="{ display: !organizationSettingsFormGroup?.untouched && organizationSettingsFormGroup?.invalid ? 'block' : 'none' }"
            ></i-feather>
          </div>
        </div>

        <div *ngIf="textFieldType === textFieldTypeControl.Numeric">
          <div class="input-container bootstrap">
            <label for="numeric">Value<span class="required">*</span></label>
            <div class="input-group">
              <ejs-numerictextbox
                id="numeric"
                class="numeric-input"
                min="0"
                [maxlength]="maxFieldLength"
                placeholder="Value"
                [validateDecimalOnType]='true'
                decimals='0'
                format="#"
                [showSpinButton]="false"
                appValidateWithMessage
                formControlName="value"
              ></ejs-numerictextbox>
            </div>
          </div>
        </div>
      </div>

      <div class="input-container dropdown bootstrap" *ngSwitchCase="organizationSettingControlType.Select">
        <label for="dropdown">Value  <span class="required">*</span></label>
        <div class="input-group">
          <ejs-dropdownlist
            id="dropdown"
            [dataSource]="dropdownDataSource"
            [fields]="dropdownFields"
            appValidateWithMessage
            placeholder="Value"
            formControlName="value"
          ></ejs-dropdownlist>
        </div>
      </div>

      <div class="input-container dropdown bootstrap" *ngSwitchCase="organizationSettingControlType.Multiselect">
        <label for="dropdownMulti">Value <span class="required">*</span></label>
        <div class="input-group">
          <ejs-multiselect
            id="dropdownMulti"
            mode="CheckBox"
            appValidateWithMessage
            [allowFiltering]="false"
            [dataSource]="dropdownDataSource"
            [fields]="dropdownFields"
            selectAllText="All"
            showSelectAll="true"
            placeholder="Value"
            formControlName="value"
          >
          </ejs-multiselect>
        </div>
      </div>
    </div>
  </form>
</app-side-dialog>
