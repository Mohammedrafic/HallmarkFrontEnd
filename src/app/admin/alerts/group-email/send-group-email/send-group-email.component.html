<div [formGroup]="groupEmailTemplateForm" id="groupEmailTemplateForm" class="group-email-template-form">
    
    <!-- validation errors-->
    <div *ngIf="isSend && isFormInvalid" class="alert alert-danger">
      <div *ngIf="emailToControl.value == ''">
        - Field Email to is required.
      </div>
    </div>

    <div *ngIf="emailCcControl.invalid && isFormInvalid"
      class="alert alert-danger">
      <div *ngIf="emailCcControl.errors?.['emails']">
        - Some of email(s) in CC not matching valid email address pattern.
      </div>
    </div>

    <div *ngIf="subjectControl.invalid && isFormInvalid"
      class="alert alert-danger">
      <div *ngIf="subjectControl.errors?.['required']">
        - Field Email subject is required.
      </div>
    </div>

    <div *ngIf="emailBodyControl.invalid && isFormInvalid"
      class="alert alert-danger">
      <div *ngIf="emailBodyControl.errors?.['required']">
        - Field Email body is required.
      </div>
    </div>

    <div class="section-container">

      <div class="left-section">
        <div class="bootstrap business-dropdowns">
          <div class="dropdown-container">
            <div class="input-group dropdown">
              <label>Business Unit Type<span class="required">*</span></label>
              <ejs-dropdownlist appValidateWithMessage
                                formControlName="businessUnit"
                                [fields]="optionFields"
                                [dataSource]="businessUnits"
                                [allowFiltering]="true"
                                [(ngModel)]="businessUnitType"
                                placeholder="Business Unit">
              </ejs-dropdownlist>
            </div>
          </div>
          <div class="dropdown-container" *ngIf="!isBusinessUnitTypeAgency">
            <div class="input-group dropdown">
              <label>Business Unit<span class="required">*</span></label>
              <ejs-dropdownlist appValidateWithMessage
                                formControlName="business"
                                [fields]="businessDataFields"
                                [dataSource]="businessData$ | async"
                                [value]="defaultBusinessValue"
                                [allowFiltering]="true"                                
                                placeholder="Business">
              </ejs-dropdownlist>
            </div>
          </div>
          <div class="dropdown-container" *ngIf="isBusinessUnitTypeAgency">
            <div class="input-group dropdown">
              <label>Business Unit<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox" appValidateWithMessage
                                formControlName="businesses"
                                [fields]="businessDataFields"
                                [dataSource]="businessData"                                
                                [allowFiltering]="true"
                                placeholder="Business"
                                [showDropDownIcon]="true"
                                [selectAllText]='allOption'
                                showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div class="dropdown-container" *ngIf="!hideUserTypeControl">
            <div class="input-group dropdown">
              <label>User Type<span class="required">*</span></label>
              <ejs-dropdownlist appValidateWithMessage
                                formControlName="userType"
                                [fields]="commonFields"
                                [dataSource]="filteredUserType"
                                [value]="defaultUserType"
                                [allowFiltering]="true"
                                [(ngModel)]="userTypeInput"
                                placeholder="User Type">
              </ejs-dropdownlist>
            </div>
          </div>
          <div *ngIf="isOrgCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Agencies<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox" appValidateWithMessage
                                formControlName="agencies"
                                [fields]="agencyFields"
                                [dataSource]="agencyData"                                
                                [allowFiltering]="true"
                                placeholder="Agencies"
                                [showDropDownIcon]="true"
                                [selectAllText]='allOption'
                                showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>               
          <div *ngIf="isOrgCandidatesType || isAgencyCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Skills<span class="required">*</span></label>
              <ejs-multiselect  mode="CheckBox" appValidateWithMessage
                                formControlName="skills"
                                [fields]="regionFields"
                                [dataSource]="skillData"                                
                                [allowFiltering]="true"
                                placeholder="Skills"
                                [showDropDownIcon]="true"
                                [selectAllText]='allOption'
                                showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgInternalUserType || isOrgCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Region<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox" formControlName="region"
                               [allowFiltering]="true"
                               appValidateWithMessage
                               [fields]="regionFields"
                               [dataSource]="regionsList"
                               placeholder="Region"
                               [showDropDownIcon]="true"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgInternalUserType || isOrgCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Location<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox" formControlName="location"
                               [allowFiltering]="true"
                               appValidateWithMessage
                               [fields]="regionFields"
                               [dataSource]="locationsList"
                               placeholder="Location"
                               [showDropDownIcon]="true"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Order Type</label>
              <ejs-multiselect mode="CheckBox" formControlName="orderTypes"
                               [allowFiltering]="true"
                               appValidateWithMessage
                               [fields]="regionFields"
                               [dataSource]="orderTypes"
                               placeholder="Order Type"
                               [showDropDownIcon]="true"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Candidate Status</label>
              <ejs-multiselect mode="CheckBox" formControlName="candidateStatus"
                               [allowFiltering]="true"
                               appValidateWithMessage
                               [fields]="candidateStatusFields"
                               [dataSource]="candidateStatusData"
                               placeholder="Candiate Status"
                               [showDropDownIcon]="true"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgCandidatesType" class="dropdown-container">
            <div class="input-container bootstrap">
              <label>Job ID</label>
              <input class="e-input"
                   type="text"
                   appValidateWithMessage
                   maxlength="50"
                   formControlName="jobID" 
                   (keyup.enter)="onJobIdStatusValueChanged()"/>
            </div>
          </div>
          <div *ngIf="isOrgInternalUserType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Role<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox"
                               formControlName="roles"
                               [placeholder]='placeholderValue'
                               [allowFiltering]="true"
                               [showDropDownIcon]="true"
                               appValidateWithMessage
                               [fields]="businessDataFields"
                               [dataSource]="roleData"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>     
          <div *ngIf="isOrgInternalUserType || isAgencyUserType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>User<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox"
                               formControlName="user"
                               [placeholder]='placeholderValue'
                               [allowFiltering]="true"
                               [showDropDownIcon]="true"
                               appValidateWithMessage
                               [fields]="userDataFields"
                               [dataSource]="userData"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>
          <div *ngIf="isOrgCandidatesType || isAgencyCandidatesType" class="dropdown-container">
            <div class="input-group dropdown">
              <label>Candidate<span class="required">*</span></label>
              <ejs-multiselect mode="CheckBox"
                               formControlName="candidate"
                               [placeholder]='placeholderValue'
                               [allowFiltering]="true"
                               [showDropDownIcon]="true"
                               appValidateWithMessage
                               [fields]="userDataFields"
                               [dataSource]="userData"
                               [selectAllText]='allOption'
                               showSelectAll=true>
              </ejs-multiselect>
            </div>
          </div>     
        </div>

        <div class="input-container bootstrap top-container">
          <label>To<span class="required">*</span></label>
          <div class="input-group">
            <input appValidateWithMessage formControlName="emailTo" class="e-input" type="text"
                   [(ngModel)]="emailTo" />
          </div>
        </div>
        <div class="input-container bootstrap top-container">
          <label>CC</label>
          <div class="input-group">
            <input formControlName="emailCc" class="e-input" type="text"
                   [(ngModel)]="emailCc" (keyup)="onCCFieldKeyup()" />
          </div>
        </div>
        <div class="input-container bootstrap top-container">
          <label>Subject<span class="required">*</span></label>
          <div class="input-group">
            <input appValidateWithMessage formControlName="emailSubject" class="e-input" type="text"
                   [(ngModel)]="emailSubject" />
          </div>
        </div>
        <div>
          <div class="id-container">
            <div class="input-container bootstrap">
              <label>Attachment</label>
              <input *ngIf="!isSend" class="e-input" type="text" disabled [(ngModel)]="fileNameInput" 
                     [ngModelOptions]="{standalone: true}" />
              <div id="group-attachment-files" *ngIf="isSend">
                <div id="files-droparea" class="droparea" (click)="browseGroupEmail()">
                  <span>Drag & Drop or <span class="browse-link">browse</span> files here</span>
                </div>
                <ejs-uploader #filesUploaderGroupEmail formControlName="fileUpload"
                              [dropArea]="dropElement"
                              [allowedExtensions]="allowedExtensions"
                              [multiple]="false"
                              [maxFileSize]="maxFileSize"
                              [autoUpload]="false"
                              (selected)="onFileSelectedGroup($event)">
                </ejs-uploader>
              </div>
              <label *ngIf="isSend">Attached file size should not exceed 2MB<span class="e-input"></span></label>
            </div>
          </div>
        </div>
        <div class="rich-text-container">
          <label>Mail Body<span class="required">*</span></label>
          <div class="input-group" id="richTextEditorDiv">
            <ejs-richtexteditor #RTEGroupEmail id='defaultGroupEmailRTE' appValidateWithMessage
                                formControlName="emailBody" [toolbarSettings]='tools' [(ngModel)]='emailBody'
                                [(value)]='emailBody'>
            </ejs-richtexteditor>
          </div>
        </div>

      </div>
    </div>
