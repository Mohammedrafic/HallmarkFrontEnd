<ejs-dialog
  id="dialog"
  #sideDialog
  cssClass="dialog"
  width="50%"
  [target]="targetElement"
  [visible]="false"
  [animationSettings]="{ effect: 'SlideRight' }"
>
  <ng-template #content>
    <section class="container preview-dialog">
      <section class="header-container">
        <div class="e-card-header preview-header">
          <div class="e-card-header-caption">
            <h3 class="e-card-title preview-title">
              Position ID {{ order?.organizationPrefix }}-{{ order?.publicId }}-{{ candidate?.positionId }}
            </h3>
            <div class="order-statuses">
              <ejs-chiplist #chipList class="events-off" *ngIf="candidate?.orderStatus">
                <e-chips>
                  <e-chip
                    [text]="orderStatusText[candidate.orderStatus]"
                    [cssClass]="orderStatusText[candidate.orderStatus] | chipsCssClass"
                  ></e-chip>
                </e-chips>
              </ejs-chiplist>
            </div>
          </div>
          <div class="e-card-content dialog-controls">
            <app-button
              *ngIf="isAddExtensionBtnAvailable && !(extensions$ | async)?.length"
              (clickEmitter)="showExtensionDialog()"
              [type]="buttonTypeEnum.OUTLINED"
              [disabled]="candidate?.orderStatus === orderStatus.InProgressOfferAccepted"
              text="Add Extension"
            ></app-button>
            <button
              ejs-button
              cssClass="e-outline"
              *ngIf="!isAgency"
              [disabled]="disabledCloseButton"
              (click)="closeOrder(order)"
            >
              Close Position
            </button>
            <button ejs-button type="submit" cssClass="e-flat close-button" (click)="onClose()">
              <i-feather name="x" class="icon"></i-feather>
            </button>
          </div>
        </div>
      </section>
      <div class="order-tabs">
        <ejs-tab #tab (selecting)="onTabSelecting($event)" (created)="onTabCreated()">
          <e-tabitems>
            <e-tabitem>
              <ng-template #headerText>Order Details</ng-template>
              <ng-template #content>
                  <section class="order-details" *ngIf="selectedOrder$ | async as currentOrder">
                    <section class="job-details">
                      <app-general-order-info [orderInformation]="currentOrder"></app-general-order-info>
                    </section>
                    <hr />
                    <ng-container *ngIf="currentOrder?.orderClosureReasonId || candidate?.positionClosureReasonId">
                      <app-order-close-reason-info
                        [candidate]="candidate"
                        [orderInformation]="currentOrder">
                      </app-order-close-reason-info>
                      <hr />
                    </ng-container>
                    <app-order-details [isPosition]="true" [currentOrder]="currentOrder"></app-order-details>
                </section>
              </ng-template>
            </e-tabitem>

            <e-tabitem>
              <ng-template #headerText>Candidate</ng-template>
              <ng-template #content>
                <hr />
                <section class="candidate">
                  <ng-container [ngSwitch]="selectedTemplate">
                    <ng-container *ngSwitchCase="template.onboarded">
                      <section class="container onboarded-candidate-container">
                        <section class="header-container">
                          <div class="e-card-header">
                            <div class="e-card-header-caption candidate-status">
                              <h3 class="e-card-title candidate-title">
                                {{ candidate?.lastName }}, {{ candidate?.firstName }}
                              </h3>
                              <ejs-chiplist
                                *ngIf="candidate.candidateStatus"
                                [text]="candidateStatus[candidate.candidateStatus]"
                              >
                                <e-chips>
                                  <e-chip
                                    [cssClass]="candidateStatus[candidate.candidateStatus] | chipsCssClass"
                                  ></e-chip>
                                </e-chips>
                              </ejs-chiplist>
                            </div>
                          </div>
                        </section>
                        <section class="content-container">
                          <div class="job-details">
                            <ejs-accordion
                              #accordionElement
                              expandMode="Single"
                              openFirstAccordion
                            >
                              <e-accordionitems>
                                <e-accordionitem expanded="true">
                                  <ng-template #header>
                                    <div>Job Details</div>
                                  </ng-template>
                                  <ng-template #content>
                                    <app-accept-form
                                      [formGroup]="acceptForm"
                                      [status]="$any(candidateJob?.applicantStatus?.applicantStatus)"
                                    ></app-accept-form>
                                  </ng-template>
                                </e-accordionitem>
                                <e-accordionitem>
                                  <ng-template #header>
                                    <div>Historical Events</div>
                                  </ng-template>
                                  <ng-template #content>
                                    <app-historical-events
                                      [organizationId]="candidateJob?.organizationId!"
                                      [candidateJobId]="candidate.jobId"
                                      [candidateId]="candidate.candidateId"
                                      [isAgency]="isAgency"
                                    ></app-historical-events>
                                  </ng-template>
                                </e-accordionitem>
                              </e-accordionitems>
                            </ejs-accordion>
                          </div>
                          <div class="comments">
                            <app-comments
                              *ngIf="candidateJob"
                              [comments]="comments"
                              [commentContainerId]="candidateJob.commentContainerId || 0"
                            ></app-comments>
                          </div>
                        </section>

                        <section class="bill-rates">
                          <app-bill-rates
                            [billRates]="candidateJob?.billRates || []"
                            [isActive]="true"
                            (billRatesChanged)="onBillRatesChanged($event)"
                          >
                          </app-bill-rates>
                        </section>
                      </section>
                    </ng-container>

                    <ng-container *ngSwitchCase="template.accept">
                      <app-accept-candidate
                        [candidate]="$any(candidate)"
                        [isTab]="true"
                        (closeModalEvent)="onClose()"
                      ></app-accept-candidate>
                    </ng-container>

                    <ng-container *ngSwitchCase="template.apply">
                      <app-apply-candidate
                        [billRatesData]="$any((selectedOrder$ | async)?.billRates)"
                        [candidate]="$any(candidate)"
                        [isTab]="true"
                      >
                      </app-apply-candidate>
                    </ng-container>

                    <ng-container *ngSwitchCase="template.offerDeployment">
                      <app-offer-deployment [candidate]="$any(candidate)" [isTab]="true"></app-offer-deployment>
                    </ng-container>

                    <div *ngSwitchDefault></div>
                  </ng-container>
                </section>
              </ng-template>
            </e-tabitem>

            <e-tabitem *ngIf="order?.orderType === orderType.ContractToPerm || order?.orderType === orderType.Traveler">
              <ng-template #headerText>Extensions</ng-template>
              <ng-template #content>
                <section class="order-details" *ngIf="selectedOrder$ | async as currentOrder">
                  <section class="job-details">
                    <app-general-order-info [orderInformation]="currentOrder"></app-general-order-info>
                  </section>
                  <hr />
                  <app-extension-grid [data]="extensions$ | async" class="extension-grid"></app-extension-grid>
                </section>
              </ng-template>
            </e-tabitem>
          </e-tabitems>
        </ejs-tab>
      </div>
    </section>
  </ng-template>
</ejs-dialog>

<ejs-dialog
  id="extension-sidebar"
  #extensionSidebar
  cssClass="dialog"
  width="45%"
  [target]="targetElement"
  [visible]="isExtensionSidebarShown"
  [animationSettings]="{ effect: 'SlideRight' }"
  [isModal]="true"
>
  <ng-template #content>
    <section class="container preview-dialog">
      <section class="header-container">
        <div class="e-card-header preview-header">
          <div class="e-card-header-caption">
            <h3 class="e-card-title preview-title">Add Extension</h3>
          </div>
          <div class="e-card-content dialog-controls">
            <app-button
              (clickEmitter)="closeExtensionSidebar()"
              [type]="buttonTypeEnum.OUTLINED"
              text="Cancel"
            ></app-button>
            <app-button
              (clickEmitter)="saveExtension()"
              [type]="buttonTypeEnum.PRIMARY"
              [disabled]="candidate?.orderStatus === orderStatus.InProgressOfferAccepted"
              text="Save"
            ></app-button>
          </div>
        </div>
      </section>
    </section>
    <div class="extension-sidebar">
      <app-extension-sidebar
        *ngIf="isExtensionSidebarShown"
        [candidateJob]="candidateJob!"
        [orderPosition]="candidate"
        (saveEmitter)="updateGrid()"
      ></app-extension-sidebar>
    </div>
  </ng-template>
</ejs-dialog>
