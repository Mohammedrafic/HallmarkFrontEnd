<ng-container
  *ngIf="isOrganization$ | async"
  [ngTemplateOutlet]="dashboardTemplate"
  [ngTemplateOutletContext]="{
    isLoading: isLoading$ | async,
    panels: panels$ | async,
    selectedWidgets: selectedWidgets$ | async,
    widgets: widgets$ | async,
    widgetsData: widgetsData$ | async
  }"
></ng-container>

<ng-template
  #dashboardTemplate
  let-isLoading="isLoading"
  let-panels="panels"
  let-selectedWidgets="selectedWidgets"
  let-widgets="widgets"
  let-widgetsData="widgetsData"
>
  <app-dashboard-control
    (widgetToggleEmitter)="handleWidgetToggleEvent($event)"
    [isLoading]="isLoading"
    [selectedWidgets]="selectedWidgets"
    [widgets]="widgets"
    [hasOrderManagePermission]="hasOrderManagePermission"
    [hasWidgetPermission]="hasWidgetPermission"
  ></app-dashboard-control>

  <ng-container [ngTemplateOutlet]="widgetsTemplate" #outlet></ng-container>

  <ng-template #widgetsTemplate>
    <div class="control-section">
      <app-dashboard-widgets
        (dashboardCreatedEmitter)="dashboardCreatedHandler()"
        (dragStopEmitter)="moveDashboardPanel()"
        [isLoading]="isLoading"
        [panels]="panels"
        [widgetsData]="widgetsData"
      ></app-dashboard-widgets>
    </div>
  </ng-template>
</ng-template>
